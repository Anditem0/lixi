<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>L√¨ X√¨ B√≠nh Ng·ªç 2026</title>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Be+Vietnam+Pro:wght@400;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <h1>Th·ª≠ Nh√¢n Ph·∫©m Ng√†y T·∫øt</h1>
  <div id="status-text" class="instruction">
    Ch·ªçn 1 bao l√¨ x√¨ ƒë·ªÉ th·ª≠ Nh√¢n Ph·∫©m n√® üòÜ
  </div>

  <div class="grid" id="grid"></div>

  <button id="reset-btn">L√†m L·∫°i B·ªô M·ªõi</button>

  <div id="modal-overlay">
    <div class="modal">
      <h2 id="modal-title"></h2>
      <p id="modal-msg"></p>
      <p id="comment-msg" style="font-style: italic; color: #8b0000; margin: 10px 0;"></p>
      <button onclick="nextRound()">Ch·ªçn V√© Ti·∫øp Theo</button>
    </div>
  </div>

<script>
const PRIZES = [
  { val: 10000, title: "Cu Em Qu√° H√™n Lun !!", weight: 45, type: 'small' },
  { val: 20000, title: "Qu√° ƒê·ªânh, ƒê∆∞·ª£c Nh·ªØng T√¢n 20k :))", weight: 30, type: 'medium' },
  { val: 50000, title: "Ch·∫Øc ƒê·ªß Ti·ªÅn N·∫°p Fai Fai R·ªìi", weight: 15, type: 'medium' },
  { val: 100000, title: "D√πng H·∫øt V·∫≠n May C·∫£ Ng√†y R·ªìi", weight: 6, type: 'large' },
  { val: 200000, title: "ƒê·ªânh N√≥c, K·ªãch Tr·∫ßn Bay Ph·∫•p B·ªõi", weight: 3, type: 'large' },
  { val: 500000, title: "V·ªù L·ªù, ·∫¢o Th·∫≠t ƒê·∫•y", weight: 1, type: 'jackpot' }
];

const WISHES = [
  "V·∫°n S·ª± Nh∆∞ √ù",
  "Ph√°t T√†i Ph√°t L·ªôc",
  "S·ª©c Kh·ªèe D·ªìi D√†o",
  "An Khang Th·ªãnh V∆∞·ª£ng",
  "Cung H·ª∑ Ph√°t T√†i",
  "Ph√∫c L·ªôc ƒê·∫ßy Nh√†",
  "B√¨nh An M·∫°nh Kh·ªèe",
  "T√¢n Ni√™n ƒê·∫°i C√°t"
];

const tease10k = [
  "10k th√¥i h·∫£? ƒê·ªß mua b·ªãch bim bim v·ªã cay!",
  "10k √†? L·ªôc nh·ªè nh∆∞ng vui nha!",
  "10k ƒë·ªß mua c√¢y k·∫πo m√∫t n√®!",
  "L·ªôc b√© x√≠u nh∆∞ng c√≥ c√≤n h∆°n kh√¥ng!",
  "10k n√†y ƒë·ªÉ d√†nh tr√∫ng l·ªõn ti·∫øp!"
];

const tease20k = [
  "20k ƒë·ªß mua g√≥i m√¨ t√¥m cao c·∫•p!",
  "20k th√¥i m√†, nƒÉm sau tr√∫ng l·ªõn h∆°n!",
  "20k n√†y mua tr√† s·ªØa size nh·ªè n√®!",
  "L·ªôc 20k ki·ªÉu c√≥ ti·ªÅn m√† ch∆∞a gi√†u!",
  "20k n√†y mua b√°nh ch∆∞ng mini!"
];

const tease50k = [
  "50k ƒë·ªß ti·ªÅn ƒë·ªï xƒÉng xe m√°y!",
  "50k th√¥i, nƒÉm sau tr√∫ng 500k nh√©!",
  "50k n√†y mua √≠t b√°nh ch∆∞ng ƒÉn t·∫°m!",
  "L·ªôc 50k g·∫ßn gi√†u l·∫Øm r·ªìi!",
  "50k n√†y mua bia T·∫øt n√®!"
];

const praiseComments = [
  "Wow, may m·∫Øn qu√° tr·ªùi!",
  "ƒê·∫°i l·ªôc ƒë·∫øn tay r·ªìi!",
  "NƒÉm m·ªõi gi√†u sang nha!",
  "Tr√∫ng l·ªõn r·ªìi k√¨a!",
  "L·ªôc ƒë·∫ßy nh√† lu√¥n!"
];

let isAnyCardActive = false;

function getRandomComment(val) {
  let comments;
  if (val === 10000) comments = tease10k;
  else if (val === 20000) comments = tease20k;
  else if (val === 50000) comments = tease50k;
  else comments = praiseComments;

  return comments[Math.floor(Math.random() * comments.length)];
}

function createCard(container, wish) {

  const prizeObj = (() => {
    let total = PRIZES.reduce((sum, p) => sum + p.weight, 0);
    let random = Math.random() * total;
    for (let prize of PRIZES) {
      if (random < prize.weight) return prize;
      random -= prize.weight;
    }
    return PRIZES[0];
  })();

  const wrapper = document.createElement('div');
  wrapper.className = 'card-container';

  wrapper.innerHTML = `
    <div class="card-inner">
      <div class="card-front">
        <div class="corner top-left"></div>
        <div class="corner bottom-right"></div>

        <div class="emblem">üßß</div>
        <div class="year-text">2026</div>

        <div class="wish-text">${wish}</div>
      </div>

      <div class="card-back">
        <div class="card-content">
          <div style="font-size:0.7rem; font-weight:bold; color:#8b0000">L·ªòC XU√ÇN</div>
          <div class="amount">${prizeObj.val.toLocaleString()}ƒë</div>
        </div>
        <canvas width="165" height="235"></canvas>
      </div>
    </div>
  `;

  const canvas = wrapper.querySelector('canvas');
  const ctx = canvas.getContext('2d', { willReadFrequently: true });

  let isDrawing = false;
  let isCleared = false;

  function drawCover() {
    const grd = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    grd.addColorStop(0, '#f1c40f');
    grd.addColorStop(1, '#d4af37');

    ctx.fillStyle = grd;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    ctx.font = 'bold 12px Arial';
    ctx.fillStyle = '#8b0000';
    ctx.fillText('C√ÄO V√ôNG TRUNG T√ÇM', canvas.width / 2, canvas.height - 20);
  }

  drawCover();

  function flipCard() {
    if (isAnyCardActive || wrapper.classList.contains('flipped')) return;

    isAnyCardActive = true;
    wrapper.classList.add('flipped');

    document.querySelectorAll('.card-container')
      .forEach(c => c !== wrapper && c.classList.add('locked'));

    drawCover();
  }

  wrapper.onclick = flipCard;
  wrapper.ontouchend = e => {
    e.preventDefault();
    flipCard();
  };

  function scratch(e) {
    if (!isDrawing || isCleared || !wrapper.classList.contains('flipped')) return;

    const rect = canvas.getBoundingClientRect();
    const clientX = e.clientX || (e.touches && e.touches[0].clientX);
    const clientY = e.clientY || (e.touches && e.touches[0].clientY);

    const x = (clientX - rect.left) * (canvas.width / rect.width);
    const y = (clientY - rect.top) * (canvas.height / rect.height);

    ctx.globalCompositeOperation = 'destination-out';
    ctx.beginPath();
    ctx.arc(x, y, 22, 0, Math.PI * 2);
    ctx.fill();

    const imgData = ctx.getImageData(30, 80, 100, 70);
    let clear = 0;

    for (let i = 3; i < imgData.data.length; i += 4)
      if (imgData.data[i] === 0) clear++;

    if (clear > (imgData.data.length / 4) * 0.75) {
      isCleared = true;
      canvas.style.transition = "opacity 0.6s";
      canvas.style.opacity = '0';

      setTimeout(() => {
        canvas.remove();
        shootFireworks(prizeObj.type);

        document.getElementById('modal-title').innerText = prizeObj.title;
        document.getElementById('modal-msg').innerText =
          `Ch√∫c m·ª´ng b·∫°n nh·∫≠n ƒë∆∞·ª£c ${prizeObj.val.toLocaleString()}ƒë!`;

        document.getElementById('comment-msg').innerText =
          getRandomComment(prizeObj.val);

        document.getElementById('modal-overlay').style.display = 'flex';
      }, 400);
    }
  }

  canvas.onmousedown = () => isDrawing = true;
  canvas.ontouchstart = e => { isDrawing = true; e.preventDefault(); };
  window.onmouseup = () => isDrawing = false;
  window.ontouchend = () => isDrawing = false;
  canvas.onmousemove = scratch;
  canvas.ontouchmove = e => { scratch(e); e.preventDefault(); };

  container.appendChild(wrapper);
}

function shootFireworks(type) {
  const colors = ['#f1c40f', '#e74c3c', '#ffffff', '#ff9f43'];

  if (type === 'small')
    confetti({ particleCount: 40, spread: 50, origin: { y: 0.7 } });

  else if (type === 'medium')
    confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });

  else if (type === 'large')
    confetti({ particleCount: 300, spread: 120, origin: { y: 0.6 }, scalar: 1.2, colors });

  else if (type === 'jackpot') {
    const end = Date.now() + 4000;
    (function frame() {
      confetti({ particleCount: 20, angle: 60, spread: 100, origin: { x: 0, y: 0.6 }, colors });
      confetti({ particleCount: 20, angle: 120, spread: 100, origin: { x: 1, y: 0.6 }, colors });
      if (Date.now() < end) requestAnimationFrame(frame);
    })();
  }
}

function nextRound() {
  document.getElementById('modal-overlay').style.display = 'none';
  isAnyCardActive = false;

  document.querySelectorAll('.card-container')
    .forEach(c => c.classList.remove('locked'));
}

function start() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  isAnyCardActive = false;

  let shuffled = [...WISHES].sort(() => Math.random() - 0.5);

  for (let i = 0; i < 6; i++)
    createCard(grid, shuffled[i]);
}

document.getElementById('reset-btn').onclick = start;
start();
</script>

</body>
</html>
